# Configuration Management with Ansible & Terraform

## ğŸš€ Project Overview

The Yolo (master branch) demonstrates  practices using Infrastructure as Code (IaC) and Configuration Management to automate the deployment of the containerized e-commerce application. The project is implemented in two progressive stages:

- **Stage 1**: Pure Ansible automation for configuration management
- **Stage 2**: Terraform + Ansible integration for complete infrastructure automation

## ğŸ—ï¸ Architecture

### Application Stack
- **Frontend**: React-based e-commerce client
- **Backend**: Node.js/Express REST API
- **Database**: MongoDB with persistent data storage
- **Containerization**: Docker containers with inter-service networking
- **Infrastructure**: Vagrant-provisioned Ubuntu VMs

### Technology Stack
- **Configuration Management**: Ansible
- **Infrastructure Provisioning**: Terraform (Stage 2)
- **Containerization**: Docker & Docker Compose
- **Virtualization**: Vagrant + VirtualBox
- **Version Control**: Git with feature branching

## ğŸ“ Project Structure

```
yolo/
â”œâ”€â”€ README.md                          # This comprehensive guide
â”œâ”€â”€ explanation.md                     # Technical implementation details
â”œâ”€â”€ Vagrantfile                        # VM provisioning (Stage 1)
â”œâ”€â”€ ansible.cfg                        # Ansible configuration
â”œâ”€â”€ playbook.yml                       # Main Ansible playbook
â”œâ”€â”€ docker-compose.yml                 # Docker Compose configuration
â”œâ”€â”€ mongo-init.js                      # MongoDB initialization script
â”‚
â”œâ”€â”€ inventory/                         # Ansible inventory
â”‚   â””â”€â”€ hosts                         # Target server definitions
â”‚
â”œâ”€â”€ group_vars/                       # Ansible variables
â”‚   â””â”€â”€ all.yml                       # Global variables
â”‚
â”œâ”€â”€ roles/                            # Ansible roles (Stage 1)
â”‚   â”œâ”€â”€ common/                       # System preparation
â”‚   â”‚   â”œâ”€â”€ tasks/main.yml
â”‚   â”‚   
â”‚   â”œâ”€â”€ docker/                       # Docker installation
â”‚   â”‚   â”œâ”€â”€ tasks/main.yml
â”‚   â”‚   
â”‚   â”œâ”€â”€ database/                     # MongoDB deployment
â”‚   â”‚   â”œâ”€â”€ tasks/main.yml
â”‚   â”‚   
â”‚   â”œâ”€â”€ backend/                      # API server deployment
â”‚   â”‚   â”œâ”€â”€ tasks/main.yml
â”‚   â”‚   
â”‚   â””â”€â”€ frontend/                     # Client app deployment
â”‚       â”œâ”€â”€ tasks/main.yml
â”‚       
â”‚
â”œâ”€â”€ backend/                          # Node.js API source code
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ routes/api/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ server.js
â”‚
â”œâ”€â”€ client/                           # React frontend source code
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ Stage_two/                        # Stage 2: Terraform + Ansible
    â”œâ”€â”€ deploy.yml                    # Main orchestration playbook
    â”œâ”€â”€ deploy.sh                     # Automated deployment script
    â”œâ”€â”€ Vagrantfile                   # Generated by Terraform
    â”‚
    â”œâ”€â”€ terraform/                    # Infrastructure as Code
    â”‚   â”œâ”€â”€ main.tf                   # Main Terraform configuration
    â”‚   â”œâ”€â”€ variables.tf              # Variable definitions
    â”‚   â”œâ”€â”€ outputs.tf                # Output definitions
    â”‚   â”œâ”€â”€ terraform.tfvars          # Variable values
    â”‚   â””â”€â”€ templates/                # Configuration templates
    â”‚       â”œâ”€â”€ Vagrantfile.tpl
    â”‚       â”œâ”€â”€ inventory.tpl
    â”‚       â””â”€â”€ ansible_vars.tpl
    â”‚
    â””â”€â”€ ansible/                      # Ansible configuration for Stage 2
        â”œâ”€â”€ playbook.yml              # Stage 2 deployment playbook
        â”œâ”€â”€ ansible.cfg               # Ansible configuration
        â”œâ”€â”€ inventory/hosts           # Generated by Terraform
        â”œâ”€â”€ group_vars/all.yml        # Generated variables
        â””â”€â”€ roles/                    # Enhanced roles for Stage 2
```

---

## ğŸ¯ Stage 1: Ansible Configuration Management

### Overview
Stage 1 demonstrates pure Ansible automation for deploying a containerized application stack. This stage focuses on configuration management, role-based organization, and automated deployment workflows.

### Key Features
- **Role-based Architecture**: Modular Ansible roles for each service
- **Idempotent Deployments**: Safe to run multiple times
- **Error Handling**: Comprehensive error handling with blocks/rescue
- **Tag-based Execution**: Selective deployment of components
- **Variable Management**: Centralized configuration management
- **Container Management**: Docker container lifecycle management
- **Data Persistence**: MongoDB data persistence across restarts
- **Network Management**: Docker network configuration
- 

### Prerequisites
```bash
# Install required tools
sudo apt update
sudo apt install -y ansible vagrant virtualbox git curl

# Verify installations
ansible --version    # Should be 2.9+
vagrant --version    # Should be 2.2+
```


#### Quick Start
```bash
# Clone the repository
git clone https://github.com/Sophie-Muchiri12/yolo.git
cd yolo

# Start VM and deploy application
vagrant up
ansible-playbook playbook.yml

# Access the application
# Frontend: http://localhost:3000
# Backend:  http://localhost:5000
# MongoDB:  mongodb://localhost:27017
```

#### Step-by-Step Deployment
```bash
# 1. Start and configure VM
vagrant up

# 2. Test Ansible connectivity
ansible webservers -m ping

# 3. Run complete deployment
ansible-playbook playbook.yml

# 4. Or deploy specific components
ansible-playbook playbook.yml --tags "common,docker"
ansible-playbook playbook.yml --tags "database"
ansible-playbook playbook.yml --tags "backend,frontend"

# 5. Verify deployment
vagrant ssh -c "docker ps"
curl http://localhost:5000/api
curl http://localhost:3000
```

#### Stage 1 Role Descriptions

**Common Role** (`roles/common/`)
- System package installation and updates
- Application directory creation
- Repository cloning from GitHub
- User and permission management

**Docker Role** (`roles/docker/`)
- Docker and Docker Compose installation
- Docker service configuration
- User group management
- Docker network creation

**Database Role** (`roles/database/`)
- MongoDB container deployment
- Data volume management
- Database initialization
- Health check verification

**Backend Role** (`roles/backend/`)
- Node.js API container building
- Environment variable configuration
- Database connection setup
- API health verification

**Frontend Role** (`roles/frontend/`)
- React application container building
- Static asset management
- Backend API connection
- Web server configuration

