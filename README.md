# Configuration Management with Ansible & Terraform

## 🚀 Project Overview

The Yolo (master branch) demonstrates  practices using Infrastructure as Code (IaC) and Configuration Management to automate the deployment of the containerized e-commerce application. The project is implemented in two progressive stages:

- **Stage 1**: Pure Ansible automation for configuration management
- **Stage 2**: Terraform + Ansible integration for complete infrastructure automation

## 🏗️ Architecture

### Application Stack
- **Frontend**: React-based e-commerce client
- **Backend**: Node.js/Express REST API
- **Database**: MongoDB with persistent data storage
- **Containerization**: Docker containers with inter-service networking
- **Infrastructure**: Vagrant-provisioned Ubuntu VMs

### Technology Stack
- **Configuration Management**: Ansible
- **Infrastructure Provisioning**: Terraform (Stage 2)
- **Containerization**: Docker & Docker Compose
- **Virtualization**: Vagrant + VirtualBox
- **Version Control**: Git with feature branching

## 📁 Project Structure

```
yolo/
├── README.md                          # This comprehensive guide
├── explanation.md                     # Technical implementation details
├── Vagrantfile                        # VM provisioning (Stage 1)
├── ansible.cfg                        # Ansible configuration
├── playbook.yml                       # Main Ansible playbook
├── docker-compose.yml                 # Docker Compose configuration
├── mongo-init.js                      # MongoDB initialization script
│
├── inventory/                         # Ansible inventory
│   └── hosts                         # Target server definitions
│
├── group_vars/                       # Ansible variables
│   └── all.yml                       # Global variables
│
├── roles/                            # Ansible roles (Stage 1)
│   ├── common/                       # System preparation
│   │   ├── tasks/main.yml
│   │   
│   ├── docker/                       # Docker installation
│   │   ├── tasks/main.yml
│   │   
│   ├── database/                     # MongoDB deployment
│   │   ├── tasks/main.yml
│   │   
│   ├── backend/                      # API server deployment
│   │   ├── tasks/main.yml
│   │   
│   └── frontend/                     # Client app deployment
│       ├── tasks/main.yml
│       
│
├── backend/                          # Node.js API source code
│   ├── models/
│   ├── routes/api/
│   ├── Dockerfile
│   ├── package.json
│   └── server.js
│
├── client/                           # React frontend source code
│   ├── public/
│   ├── src/
│   ├── Dockerfile
│   └── package.json
│
└── Stage_two/                        # Stage 2: Terraform + Ansible
    ├── deploy.yml                    # Main orchestration playbook
    ├── deploy.sh                     # Automated deployment script
    ├── Vagrantfile                   # Generated by Terraform
    │
    ├── terraform/                    # Infrastructure as Code
    │   ├── main.tf                   # Main Terraform configuration
    │   ├── variables.tf              # Variable definitions
    │   ├── outputs.tf                # Output definitions
    │   ├── terraform.tfvars          # Variable values
    │   └── templates/                # Configuration templates
    │       ├── Vagrantfile.tpl
    │       ├── inventory.tpl
    │       └── ansible_vars.tpl
    │
    └── ansible/                      # Ansible configuration for Stage 2
        ├── playbook.yml              # Stage 2 deployment playbook
        ├── ansible.cfg               # Ansible configuration
        ├── inventory/hosts           # Generated by Terraform
        ├── group_vars/all.yml        # Generated variables
        └── roles/                    # Enhanced roles for Stage 2
```

---

## 🎯 Stage 1: Ansible Configuration Management

### Overview
Stage 1 demonstrates pure Ansible automation for deploying a containerized application stack. This stage focuses on configuration management, role-based organization, and automated deployment workflows.

### Key Features
- **Role-based Architecture**: Modular Ansible roles for each service
- **Idempotent Deployments**: Safe to run multiple times
- **Error Handling**: Comprehensive error handling with blocks/rescue
- **Tag-based Execution**: Selective deployment of components
- **Variable Management**: Centralized configuration management
- **Container Management**: Docker container lifecycle management
- **Data Persistence**: MongoDB data persistence across restarts
- **Network Management**: Docker network configuration
- 

### Prerequisites
```bash
# Install required tools
sudo apt update
sudo apt install -y ansible vagrant virtualbox git curl

# Verify installations
ansible --version    # Should be 2.9+
vagrant --version    # Should be 2.2+
```


#### Quick Start
```bash
# Clone the repository
git clone https://github.com/Sophie-Muchiri12/yolo.git
cd yolo

# Start VM and deploy application
vagrant up
ansible-playbook playbook.yml

# Access the application
# Frontend: http://localhost:3000
# Backend:  http://localhost:5000
# MongoDB:  mongodb://localhost:27017
```

#### Step-by-Step Deployment
```bash
# 1. Start and configure VM
vagrant up

# 2. Test Ansible connectivity
ansible webservers -m ping

# 3. Run complete deployment
ansible-playbook playbook.yml

# 4. Or deploy specific components
ansible-playbook playbook.yml --tags "common,docker"
ansible-playbook playbook.yml --tags "database"
ansible-playbook playbook.yml --tags "backend,frontend"

# 5. Verify deployment
vagrant ssh -c "docker ps"
curl http://localhost:5000/api
curl http://localhost:3000
```

#### Stage 1 Role Descriptions

**Common Role** (`roles/common/`)
- System package installation and updates
- Application directory creation
- Repository cloning from GitHub
- User and permission management

**Docker Role** (`roles/docker/`)
- Docker and Docker Compose installation
- Docker service configuration
- User group management
- Docker network creation

**Database Role** (`roles/database/`)
- MongoDB container deployment
- Data volume management
- Database initialization
- Health check verification

**Backend Role** (`roles/backend/`)
- Node.js API container building
- Environment variable configuration
- Database connection setup
- API health verification

**Frontend Role** (`roles/frontend/`)
- React application container building
- Static asset management
- Backend API connection
- Web server configuration

